include("build_loss.jl")
using ForwardDiff
mat = get_mat()
sloss, ploss = make_loss(prob, leish_model, mat, ts);
#sloss, ploss = make_double_loss(prob, leish_model, mat, ts)

logploss = logp -> ploss(exp.(logp))
logp0 = log.(prob.p)
logpt = copy(logp0)
loglbs = -12*ones(size(prob.p))
logubs = 8*ones(size(prob.p))

function logg!(grad, p)
    grad[:] = ForwardDiff.gradient(logploss, p)
end

using Optim
opti = Optim.Options(time_limit=200, iterations=100000)


inner_optimizer = LBFGS()
""" 
only uncomment one of the optimisation lines:
"""
# gradient-based, with bounds
#results = optimize(logploss, logg!, loglbs, logubs, logp0, Fminbox(inner_optimizer), opti)

# gradient-based, without bounds
# results = optimize(logploss, logp0, LBFGS(), opti)

# gradient-free, with bounds
#results = optimize(logploss, logg!, loglbs, logubs, logp0, Fminbox(NelderMead()), opti)

#gradient-free, without bounds
#results = optimize(logploss, logp0, NelderMead(), opti)

"""
inf: gradient based is fasqter and gets to a better estimation. but if the initial error is really high
or if the dynamics are very stiff, then it can freeze.

gradient-free is slower, but more reliable, especially when  the error is very high
"""

# logp0 = results.minimizer
# newp0 = exp.(logp0)

# probnew = remake(prob, p=newp0)
# solnew = solve(probnew, AutoTsit5(Rosenbrock23()))
# @show newp0

# using BlackBoxOptim
# res = bboptimize(logploss; SearchRange = (-5.0, 5.0), NumDimensions = 2)


"""
[p1, d_TLR4, c_TLR4, p2, p3, c_NOTCH3, d_NOTCH3, p7, p6, p5, d_TRAF6, c_TRAF6, c_MAP4K3, p9, d_MAP4K3, c_NFkB, d_NFkB, p10, p51, p11, p12, d_IL1B, c_IL1B, d_TNFA, p13, c_TNFA, c_CREB, p15, p16, d_CREB, d_IL10, p17, c_IL10, p52, c_STAT3, p19, d_STAT3, c_NLRP12, p20, d_NLRP12, c_CCL24, d_CCL24, p22, d_TIFAB, c_TIFAB, p23, c_TP53INP1, p25, p24, d_TP53INP1, d_FOS, c_FOS, p26, p27, d_NADP_oxi, c_NADP_oxi, p28, p29, d_ROS_cytos, c_ROS_cytos, p30, p31, c_Leish_amas, d_P2RX7, p32, c_P2RX7, p33, p34, c_NFE2L2, d_NFE2L2, p35, c_Glutathione, d_Glutathione, p36, c_ATP_ext, p37, p38, d_ATP_ext, d_Adenosine, c_Adenosine, p39, p40, c_ADORA2B, d_ADORA2B, p18, d_ATP_cytos, c_Glycolysis, d_Glycolysis, p43, p41, p14, d_Pyruvate, p44, p45, c_Succinate, d_Succinate, d_TCA, p55, p46, c_QH2, d_QH2, p53, p48, d_ATP_Mito, p47, o_ATP_Mito, d_ROS_Mito, o_ROS_Mito, p54, p49, c_HIF1A, d_HIF1A, c_Lactate, p50, d_Lactate]
[7.997817393905153, 1.1136116745002569, 4.507955016419372, 0.8194090525592266, 0.5491534052069665, 1.2638362356352135, 0.41001729042751967, 0.7512491720746811, 0.08257032665127426, 10.876313379887414, 0.539977663640203, 1.4020066027093268, 0.02803873006548414, 0.03993670108927638, 0.28394812023834454, 0.42602879450143377, 0.0604635366034429, 30.320903194808803, 0.2676204051794553, 0.4447439049145092, 1.3724140117198194, 6.196801203633075, 0.7111551344959454, 0.7347594941698692, 0.7294138901415256, 0.12158451000783355, 0.4502955475439474, 0.13137802402199028, 0.9462122709484724, 1.0739003046122595, 1.074524389588361, 3.2315246901690884, 0.38847448515430477, 0.4512687928584498, 2.1280244522000147, 3.2461907083876693, 0.15433760933290902, 0.5993659249666682, 0.1579973794104328, 0.040541005747375444, 1.223088878602843, 0.40533086988367345, 1.973309751718432, 1.6998912333066716, 9.73019915066195, 0.01347810863736267, 1.3518994319656927, 0.011740024908667534, 0.3658323641898978, 0.2965574233710732, 14.143695115237007, 0.8714984042192498, 245.6065036012396, 1.8681757736452005, 10.042931020895859, 1.06393829394401, 0.04424049546530959, 3.234495699858896, 0.6040082298409467, 0.92392114106042, 0.8777160078968583, 14.769166791069242, 0.8389612384322118, 1.865653971463285, 0.275228499092066, 0.7723926915170699, 25.94653273110244, 3.825356942347763, 1.0947759132700883, 1.2513428425277067, 0.24114753225526306, 0.524523728700494, 2.4482783290674117, 0.7316875149755065, 0.009175356950602467, 5.6334568053915905, 0.07001715959269646, 0.07001715959268669, 1.401112234028983, 0.09957885864456366, 33.59623436563352, 0.05568179420276125, 2.558266451640381, 0.6306329106995697, 0.006900514681050322, 0.0746768017141258, 0.4090279202848245, 5.167253450434819, 3.03773891160972, 0.012002805601050782, 0.19622145347559256, 3.8900365077696963, 0.4885982118220752, 1.7381298930658156, 11.825000775860145, 1.1619762123129376, 0.4768048968294965, 1.0639478268331277, 0.18349822019868695, 1.4615566262045236, 0.14844072424602503, 0.03842099196238343, 1.0987297362358124, 7.80452811836117, 5.078824749905937, 1.240778497369892, 28.929455339645937, 0.5276981905667347, 0.49274280417248756, 8.252165620272105, 0.39506993946660435, 3.03096050407549, 6.918195903622194, 0.09275437809258796, 0.5516772473290279]
"""
grad = deepcopy(logp0)
function step!(logpt, lr)
    logg!(grad, logpt)
    test = logploss(logpt - lr*grad)
    if test < logploss(logpt)
        logpt .-= lr*grad
    end
    println(logploss(logpt))
end

function take_steps(logpt, lr_init, steps)
    lr=lr_init
    count = 0
    for i = 1:steps
        lossnow = logploss(logpt)
        step!(logpt, lr)
        if logploss(logpt) < lossnow
            count += 1
        else
            count = 0
            lr = lr/2.
        end
        if count >= 5
            lr *= 2
            count = 0
        end
    end
end

# manual logpt
# [3.358568195840829e-17, -0.04898244226680149, -0.4921475286991152, 1.1271696183244327e-19, 0.0331481908754603, 0.1676576180127042, -0.2265450140362716, -2.62471015175021, -2.9088016985364935, 1.2492605564056405, -0.2602215738905227, -0.2677280664010497, -0.12233755408653015, 1.8379754982783658, 0.27865868802032606, 0.007608686131029724, -0.2079775596628867, 0.12957005689913698, -0.029567597451288962, 0.1811573888113804, -0.5776182201727438, 0.151032321335808, -0.037033495278936325, -0.040733555361244365, 0.03665331686256763, -0.01061285497933064, -0.05661760295053759, -0.057884264054324154, -0.41172520767641363, 0.25714790315471436, -0.571860363277909, 0.29341736870968876, 0.06052166833549143, 0.05599810392883614, 0.1582665025816805, -0.8520519697862079, -0.0896953878672011, 0.12241431986242529, 0.41876728631909527, -0.5210147201380525, 0.0511073930221482, -0.4747435653142571, 0.26201647720809756, 0.2357343176091904, 0.041427657298210754, -0.4474552163898447, -0.017786898263585312, -0.4253884192112639, -0.28052372177418816, 0.5744339714960257, 0.28295590206275656, 0.03327916597154477, 2.0416945412335137, -1.6381167578674165, 0.10330706186863398, -0.2171270202809883, 0.020454168627373523, 0.3055395545034498, 0.06609859613198861, -0.07670323562972402, 0.0022357526648950393, 0.26815341769489975, -0.3293261537792904, 0.016219762908339156, -0.08150406917669856, -0.06806434980816509, 0.007682802208951741, 0.13548335476181525, -0.10277268700922762, -0.005578869278063031, 0.06637056891093804, -0.011780492977786685, -3.768181438676877, -0.2207631773871183, -2.5434496351791607, -2.543449635179161, -1.8185081181888876, -0.14000476701869008, 2.4987101610708438, -1.4122937341550263, -0.028930692264619348, 0.5526485758868033, 0.2818679629492465, -0.22076317738711818, 0.030866612728334596, -0.32383445532725047, 0.6810142012136122, -2.35048556008997, 0.4852720033131018, -0.33744286258265416, -0.27499547975284594, -0.5502378397540179, 0.06730887493616841, -0.19244166231176152, -0.05565504597260585, -0.02766261744011013, -0.06859950239153374, 0.03819478788184123, -0.11900200280391664, -2.0727019229879518, -0.09342050216187585, -0.35375554522087777, 0.5967238248772644, 0.04737086195034889, 0.2159964712866527, -0.04771256133422903, 6.2892210371241e-21, -0.4972248416570943, 0.17140772088562772, 0.03925273779643394, -0.42008859454128145, -0.0050171005430118465, -0.374261789935345, 0.4047498445646439]
# [9.392480331012374e-17, -0.2083256191668359, -0.40427148869387936, -2.8826497147335103e-19, -0.054845944847555714, 0.6865514040794671, -0.8463928840655414, -2.323388079930044, -3.248199901224032, 1.6709753370473954, -0.6574024349287764, -0.3420353213758678, -0.2617203370710714, 1.980444645181641, 0.5090476068998282, 0.05556714693374195, -0.08609405559143476, -0.037312974243643, -0.04470609540677662, 0.2022348245465227, -0.846445893323001, 0.1705934231311498, -0.09843389278775234, -0.02504369322516673, 0.024407273137566812, -0.03605443128956435, -0.07904189988838396, -0.07404421838859304, -0.4874669987988219, 0.30681446473315827, -0.699943932857295, 0.13144191987988849, 0.026786080018155006, 0.013531352741823495, 0.31124870229227497, -1.1786132523471387, -0.3554634978624027, 0.10775134377719708, 0.3139291808213209, -0.70592769371464, 0.02340347465262324, -0.7424366081358441, 0.08359574462387943, 0.1691948483675787, 0.05823597156164495, -0.6428464068372232, 0.003443211302437424, -0.4365755955315987, -0.2624829653703233, 0.5236984446944928, 0.5123638555870088, -0.24633027219388887, 2.097606214003177, -1.5882657720990705, -0.10909771662520683, -0.23727906284449543, 0.02447624540146693, 0.4657408535508771, 0.05040093911338256, -0.07181775696293541, 0.006741718086204697, 0.0479205745007051, -0.08813043788867847, 0.026356222797517974, -0.35533537535260024, -0.028843877595353007, 0.04121870683555689, -0.040432760777053385, 0.03132647779408811, -0.007058957229236871, 0.11947344602971141, -0.06792144662226487, -4.947707663531384, -0.2820220038033632, -2.5602178564959583, -2.560217856495958, -1.8427510016656747, -0.8777900868557571, 2.481871918866165, -1.856677557200447, 0.013591343249528206, 0.1457288103317644, 0.39212801201747133, -0.2820220038033633, 0.016593477460746364, -0.2327530208028538, 0.5454053262421654, -2.572720623046679, 0.5588133080589143, -0.4308107149353187, -0.3994109436952327, -0.5806019119119047, 0.10718562036317526, -0.30297478864528354, -0.18076641820225015, -0.10018305396785014, -0.22492346616978184, 0.07073123444885185, -0.26996132018858215, -2.0514298083033706, -0.3212642187551001, -0.3174334920514698, 0.7508757942147692, 0.04952470208123533, 0.3632624396246848, -0.09677109746029681, 2.733966349463594e-21, -0.8664189196252838, -0.09685948054997423, 0.09719846752865291, -0.8520321535940082, 0.02714057579266201, -0.5380681357137976, 0.38039465736365025]
# [1.2271051360329508e-16, -0.25000557646300475, -0.3544205402051104, -7.179161682088919e-19, -0.13771676261633972, 1.3004043714015336, -1.6659837890295273, -2.2194415372806846, -3.4012636411183834, 1.6675636012920836, -0.8436763617122469, -0.38415081463667167, -0.33781354655677304, 1.9826341286899536, 0.5167354357643374, 0.06558169547187288, -0.07989333304756213, -0.05235192241829799, -0.045279063485228005, 0.23344335697288796, -0.9732047994567558, 0.1645582044841371, -0.12741529753894568, -0.033673357589851315, 0.032702964693893395, -0.0486473447879508, -0.09259719047145974, -0.00798828629902967, -0.5571958467374665, 0.30849247098928184, -0.7253305968716479, 0.09698137040444688, 0.007648305225960046, 0.006386004141404844, 0.39305286176591575, -1.3241919161540947, -0.477845427069657, 0.09988194281274934, 0.26915212141421996, -0.7463410711051826, 0.009578497795906402, -0.8208610390433199, -0.008151005079366253, 0.11829596309338936, 0.0656218090920619, -0.7105203356349513, 0.013182297771206148, -0.46714395064874786, -0.24695679247615296, 0.5124303857278896, 0.5234311424718245, -0.3647668208697401, 2.0991219445466736, -1.503692589476946, -0.2261489732770288, -0.2310160458499, 0.027229441685883617, 0.4527190907844184, 0.06317176401723956, -0.08730120123572123, 0.005821559995442182, -0.00904182003737343, -0.04982848050952277, 0.022373948154415572, -0.4931756166526145, -0.08811106723600055, 0.0658505533706301, -0.14176089113060755, 0.14222101826889663, 0.0019800118277603046, 0.08516071395777919, -0.0591383389706792, -5.248381024737606, -0.28650732194358497, -2.564739073873388, -2.564739073873389, -1.8528102525959307, -1.1113747951732922, 2.491013754200406, -1.9659239023262869, 0.026167053147824703, 0.04344612973703858, 0.40098841353037545, -0.2865073219435848, 0.006957608841519016, -0.17961098939306938, 0.5087605275059467, -2.696305406618897, 0.5464173735606574, -0.4541711217855616, -0.44243055440687373, -0.5684142109709693, 0.11582511552930454, -0.32808440460559035, -0.23556793970610113, -0.1463031304564283, -0.27513254845771856, 0.08087444750036381, -0.37222492752908604, -2.0264611713527927, -0.4352725251883177, -0.28115382548078427, 0.7888181803423986, 0.047056291522002386, 0.3998761263773909, -0.11331442792703476, -4.336444128415319e-22, -0.9836897259240128, -0.20832854836199619, 0.10505923816541635, -0.999435683365105, 0.04086767255731183, -0.5794700437533401, 0.3283081638684402]
# [-0.4970493894175705, -0.316973687928094, 0.2726956585422831, 0.27277737987774187, 0.042008698350515614, 0.047421661733215666, -0.08539563381312251, -2.5245465892982755, -2.55333114045589, 0.29477625516633904, -0.30692870333305877, 0.10356769683154071, 0.2045956501839678, 0.13895759216032266, -0.2658664117787038, 0.02772212510166575, -0.14825181692510347, 0.28784039346574375, -0.14324512115433916, -0.14252455904967554, -0.229989441113007, 0.30140255546893946, -0.01458534815117597, -0.14626476140847441, 0.17501117148932166, 0.00860644785826548, 0.045446945391409255, -0.06202389506744593, -0.44168061019443, 0.1754933371494754, -0.6314997040846799, 0.36032883574019636, 0.0690172130948765, 0.055407828317809785, 0.03335066025309245, -0.3165528029950136, 0.013521007975780859, 0.028719743964718884, 0.3031397919447103, -0.320128403254357, 0.024027690699481106, -0.2748900281241607, 0.22288754385355375, 0.18954897407502616, -0.011420798175664904, -0.2513413370090669, -0.024214522694541014, -0.3812197040977416, -0.24076575784039814, 0.5015967955381607, -0.6209695777203514, 0.09918504302707921, 1.1070360562706174, -1.4248746111558985, 0.23993711623880948, -0.21700178170897913, 0.026176008653472846, 0.24644905606086284, -0.04716672675013672, -0.007343945731077861, 0.012178846858626934, 0.1418933858069582, -0.07854396210177218, -0.003845606790872918, -0.16208322724532226, -0.09052895158196393, -0.006751311516255583, 0.1267651711316068, -0.08176629168198662, -0.00595818148528948, 0.005642358161788142, 0.007208181908352417, 0.05911826539757881, -1.1636698599439554, -0.5723055780675028, -0.572305578067503, -1.8256084406208632, 0.08972427912834617, 0.9322981494408216, -1.3481156898032318, 0.03313494183456257, 0.7049027459571812, 0.1298552876605024, -0.20164475335733625, 0.04960889919838413, -0.2993340977824062, 0.8641314796935824, -1.9935680339556852, 0.2943083618731467, -0.19861573472959304, -0.10215930514361507, -0.3005048047582424, 0.04572916312675251, -0.14593828896680064, -0.008284946694613007, -0.004428622494463814, 0.1009791064102538, 0.03161205508301326, -0.14682088522855458, -1.67226913618788, -0.010666463002241692, -0.27491348834868784, 0.3668582069290498, 0.03336734088281094, 0.05660926225324815, -0.018544003103315197, -0.03396195410249999, -0.16892952922683546, 0.4317872007390188, 0.04935567169067312, -0.4547387080268071, -0.0011689673987523334, -0.11398002029563399, 0.08596642616471173]
# [-0.20979725512306704, -1.043815671756664, 1.3007617193429974, 0.9210842146295017, 0.37260558865950383, 0.17206077786004922, -0.7071820008266582, -2.3158748316680047, -2.7831166599296746, -0.41107198954947255, -0.3841513534986759, 0.15632851010495624, 0.3523291924947934, 0.1303312309214003, -0.06601068937761398, -0.03478984234749924, -0.09227893850653594, 0.36295358601564776, -0.27033027183492153, -0.1533252931999709, -0.2252025806721669, 0.34982987760482553, -0.04090462254800097, -0.1773125298676491, 0.2268359954076785, -0.018133620939439057, 0.04514254796193515, -0.14236597991173394, -0.41262187035196174, 0.145649401283039, -0.8767637745309786, 0.3644025603804865, 0.05291979791662794, -0.06936240510173293, 0.07455736335792414, -0.6876887079120357, 0.049174149045042526, 0.04735025716058885, 0.37479880797545323, -0.5396763454053735, 0.012803004916490132, -0.5027215473317426, 0.2145733204984138, 0.15800956207869205, 0.0003055843559089876, -0.42533100964179144, -0.020826059999959057, -0.5067894389245595, -0.2530087686293475, 0.5648467634580786, -0.16731367561678434, 0.15446892950286364, 1.578456290783378, -1.462155895822503, 0.25766720082880673, -0.26018241340168125, 0.03202570076949732, 0.28773494828341767, -0.04406921251718569, 0.046523701904949734, 0.017313280841140647, 0.02527759931535705, -0.16422922497937734, -0.01904244473647967, -0.1246763311929272, -0.03969400144072626, -0.0035044675144857507, 0.038974615357941104, -0.033484476621000236, -0.019441907383730025, 0.03941882195733471, 0.03933399141754545, -0.08128048533485853, -1.4291749439710102, -0.7366358488890806, -0.7366358488890807, -1.7613805869438626, -0.054018451880291536, 0.985803884840406, -1.7973373447895593, 0.08354660198730833, 0.32925877641467777, 0.4031732110587956, -0.270033141374699, 0.033480040125671524, -0.2750914215194274, 0.9400191289138029, -2.1468846168390257, 0.5670246675771715, -0.3564252366958939, -0.2893649254075597, -0.519886627864754, 0.05656121266520592, -0.149013046849657, -0.06703024947940156, -0.03123842669163612, -0.021494099909247798, 0.033889154432376466, -0.13943936881713928, -1.92490558037599, -0.10693340226231081, -0.38022227428014793, 0.7166454796842173, 0.05198806408348425, 0.13353644943626244, -0.055380550185001196, -0.019893682217494615, -0.470552453064225, 0.35759823447271744, 0.027302855106444344, -0.513149929076927, -0.010369310352012042, -0.2802152847361534, 0.28139711007100227]


# newp0 = [18.032130820805925, 8.72045634625789, 44.93228969918933, 0.9522252424164783, 0.019872116306400567, 1.169726061181154, 0.4789101136454623, 16.349334177604707, 1.2766612767317493, 0.7326821060551159, 2.6070101412474915e10, 5.706415520607599, 1.8233411329900568, 0.029927725446884688, 1.9411206927668054, 0.09402649047003271, 0.8325722246911003, 0.42996815363645996, 0.9270475101817808, 0.5594098236341242, 630.8458676761157, 0.24229289776769752, 0.5036516150277129, 9.128945120265513e-5, 118.28140769469891, 2.3598107172605495e-6, 0.49443226302359283, 1.0987317373148364, 54.25500402527614, 0.2738866581068761, 0.00019409806255785755, 0.01770633680455052, 0.7938767331104424, 0.8406041750362198, 0.9957785310837797, 0.1298918557278898, 0.024922138363273224, 0.8178824745222842, 7.046220204518579, 0.5668941362605329, 0.02949866518622927, 4.411907456236449, 0.9436712550021904, 0.9195827101630621, 142607.94117000283, 0.2509258725532737, 1.0365975488196333e-8, 0.0428143213258294, 1.5127505545917506, 3.3975381475100788, 0.4267453884760376, 0.9441745073486122, 1.3639244485747806, 0.6107046110050169, 0.8867021488416177, 0.4247961791496621, 0.6896898972538327, 0.6668738228307606, 0.47842063799086015, 1.4641827744599882, 2.4006847793945467, 0.21151643808075843, 28.627483658504172, 0.04555218513195372, 3.139585741213331, 0.4934045216439149, 0.8600646712861861, 0.0001881318073286335, 0.7883761777760122, 0.41688183544591784, 0.9338390128605739, 0.21702110915802264, 1.016202518631769, 1.0180864179705016, 0.8176076071316467, 0.15437899832460217, 0.4349272002221094, 0.005874400302950186, 0.011577593190335382, 0.2342695106064851, 0.7295646020203818, 1.5142086741524148, 0.5579118319579467, 0.8561847597386606, 0.18022334328821957, 1.0151211732578136, 0.7462305424881363, 0.5321498989895669, 0.16182280005966096]

# 18 april runs

# these were after adding p65 and estimating
# newp0 = [11.73745571759074, 11.80340052788367, 0.014573372669552762, 1095.3113457281988, 0.08888992090682801, 0.0033301412001652503, 65.32663745668897, 0.004441970352860759, 653.3014545799278, 0.14745871416151768, 0.027490470243002794, 5.36969314176513, 0.3204591101669347, 1096.583034646863, 0.005508140276365554, 0.35516123197734273, 0.0005176657571404762, 0.006092011635644215, 0.5704277402107919, 0.0833963413326364, 0.11805780301132492, 0.013476031277538218, 205.3254016392219, 374.9156315648919, 0.09012248080683265, 0.0011020358511032388, 81.99698878198578, 0.0013180435653686188, 0.15293673262642313, 0.0029026722992750754, 0.10144621437240707, 0.09158390454761525, 2.1937541325900214, 0.3364114088302867, 0.4033543890555017, 1.1654479010400319e-17, 1.7237568892289608e-10, 1.8528832346552504, 0.47414258410890686, 0.23677716436757418, 5.309955901490131, 0.020481784152121516, 3.574680994494029, 20.400834780855703, 1.5855145353833278, 0.01380067282564184, 2.8807946594057147e-5, 0.0001960572524674622, 11.498171517728778, 3.592143155019631, 1.100316257824452, 0.23164843438507923, 0.14627624418051322, 0.057640410634249906, 0.022096965913996652, 0.11868001115079001, 1.4742794274830375, 0.5790386841687432, 5.4271508238046134e-5, 0.14634499373292725, 0.22317795427567513, 2.1973011099797533, 7.0906235333778875, 0.06039380165674131, 2.4532142925253546, 0.06060059401307028, 12.237169298592915, 2.9704889547021427, 0.7812269578291817, 2.4825620043785792e-5, 0.3230377679677492, 0.3029410492398873, 12.37682817921079, 0.0012092907616664391, 1.5513200412805188, 0.604280231469957, 0.6421464340950479, 0.010925575209057964, 4.291043787900642, 0.014886757848376828, 1.4715084587019984, 1.0517784846595235, 0.682745643889573, 24.468628881057253, 0.007527498845575771, 1.5352121402778396e-5, 0.000484043344543354, 13.25343587911369, 0.42014519512657794, 0.7159455833353651, 0.5948706951241672]
# [11.838759122295661, 11.94591154711126, 0.014573378468527916, 1140.715055691817, 0.08885618974782222, 0.003329944436905553, 65.24200795872918, 0.004441966459161043, 654.0158864611363, 0.14745854376157158, 0.02748924293491162, 5.369302314179034, 0.32045896276025715, 1096.5802069125914, 0.005508136281047949, 0.3549717418271332, 0.0005176471675347932, 0.00609176245896522, 0.5708407668215745, 0.08339605642599146, 0.11805716157061452, 0.013475836795992563, 205.3451059776061, 374.9570259444011, 0.09012200155058962, 0.0011020357763805375, 81.99371889661624, 0.0013179950592224715, 0.1531561557130124, 0.002902571784247497, 0.10145277628166458, 0.09157226037613168, 2.193629603667301, 0.33635703112767856, 0.4033543890637509, 1.1654479010400319e-17, 1.7237568890244432e-10, 1.852689782169622, 0.47402679607051285, 0.2368293266127232, 5.3604433423140785, 0.020480487342814175, 3.5437652079415733, 20.401845164609195, 1.5856090574801827, 0.013800322416317406, 2.8807946594057147e-5, 0.0001960572524674622, 11.516970392311633, 3.59203853485525, 1.100241553825585, 0.23164906614191252, 0.1461692942949536, 0.014188167539290367, 0.02209696642262355, 0.11867605190144591, 1.4746293692792103, 0.5790385238222324, 5.427165033025631e-5, 0.14675819628496833, 0.2230808219226592, 2.196954867909674, 7.11289868372104, 0.06035652779965218, 2.451555719608799, 0.06054539976383381, 12.24347236035419, 2.9704979427012117, 0.7812386217196374, 2.482492464034617e-5, 0.323037620210659, 0.30294091929536093, 12.376828940307742, 0.0012092907616664391, 1.5513199545556298, 0.6042802314698211, 0.6421464385699056, 0.010925574326650743, 4.2910442505495645, 0.014886758425422872, 1.4715092261125415, 1.0517761523925044, 0.6827455466359317, 24.468614937377094, 0.007527502944506998, 1.5352166599471413e-5, 0.00048404629509233503, 13.253244784098847, 0.42014411767775134, 0.7159453559309715, 0.5948703680884486]
# [12.066597620590349, 8.014113879600668, 0.007889436427737541, 403.0679596812273, 0.09627496321345119, 0.0006807933001909435, 4.191317376629531, 0.00039595194114729423, 52.15445721441682, 0.02493739312388009, 0.03528480368570083, 7.716772991687648, 0.1542066563977418, 0.9584215202831308, 0.00013907309948924226, 0.5599758596214227, 0.0006903398365799231, 0.012472444595619737, 0.5778252402178956, 0.11352675437442555, 0.040592399211824226, 0.08278640515531788, 118.7907114361245, 216.878908970782, 0.039176442317040365, 0.2245974351794683, 130.0615963071602, 1.8823508128559397e-5, 0.0967658815626985, 0.0010198343982841115, 0.11206141477854666, 0.06402166275276584, 1.4143006433271248, 0.23821024386483736, 0.40563406386399786, 3.095301990690213e-9, 8.11547282360502e-16, 1.2224747797031956, 0.5998592962709782, 0.3988403329816608, 2.246730244729916, 0.0004509862952689916, 5.310511114299768, 15.110558110722188, 1.4441872520382946, 0.01672378599590559, 0.00015061731975189068, 1.4920937306046459e-5, 11.778678259672787, 1.0242743796285827, 1.1679730493835059, 0.05210745677828477, 0.48035249752888004, 0.002231579517531034, 0.039715831613597714, 0.1515575658312595, 1.5456976831815425, 0.6818802051399767, 4.447710226309526e-6, 0.14017735286517388, 0.21858264586431142, 2.277102732483867, 7.30073657034604, 0.0543229802976428, 2.2608672695953955, 0.05946567078768197, 15.891696751624162, 7.6566618954988, 0.7887290237873451, 1.6024736683023663e-5, 0.2993679892787363, 0.26976222407652295, 0.425813768078344, 0.6650712335897431, 1.3503066772607475, 0.6738727423296741, 0.7294711565544139, 0.018510541810641507, 8.915153430776789, 0.00024459742865876147, 0.9111724900783087, 1.0716923525522097, 0.6859807989115627, 4.977251934898437, 0.0003591994172726792, 5.5108939648082065e-8, 7.577639744616463e-6, 6.448530763468746, 0.8466678986398317, 0.6907140639426685, 0.5205532142382318]
# this works!
# newp0 = [1.119629574548108, 2.462556972242513, 0.9355834573360627, 148.41314476133255, 0.10837550457022231, 0.007209667195496373, 0.01479418912850152, 2.90700012861237, 6.230869197677067, 0.12933727250999882, 0.02567428002405303, 2.5331718320554675, 1.0822694554630485, 0.9890937033834456, 0.05384941718432805, 4.140588319958704, 0.047735985359618475, 0.4793693881799984, 1.4418577010032014, 0.5214204975870486, 0.22068227798494056, 1.5064206477797648, 0.059285746404544655, 0.06795678985997293, 0.0021298220707384502, 0.0007628074135559597, 0.04442848800539405, 0.007035677299299147, 2.1342850504820725, 0.01928239746710363, 0.518386446893314, 0.013691212925864287, 3.925667970159427, 7.489039963148637, 0.14314792616506075, 2.4599611587372032, 3.237022953823599, 0.7252216611381633, 2.2060396032138834, 0.979110933417815, 0.11809389258154246, 0.011715797868630216, 0.225333997470682, 0.17734031312381848, 136.3456164348827, 0.004944666847100141, 0.6184861784056558, 0.6184861784056567, 0.1875869873226532, 2.2762451867443154, 4.976491310162837, 0.27939886005218234, 4.9706773388381285, 0.6417742738201706, 0.9717048432056113, 3.33621034958221, 0.9913268688214887, 0.5742604120756611, 2.6450119683076405, 0.6258744208988621, 1.4133462203428973, 0.41524571033422525, 0.17461297605027573, 23.7137869993343, 0.2397298631847125, 1.655841555430765, 0.5747803891718678, 1.3217843927984128, 0.03980563849748977, 0.6565730858040473, 0.6565730858040445, 3.4062940760395555, 0.004531879698188343, 10.126310688561649, 0.6184681984144683, 4.219745008743269, 0.09136110557472474, 0.015739335056541667, 0.013145925425958915, 0.06320958453143995, 0.6309557657301974, 12.297308039156668, 1.4120973146375984, 0.6138438392558216, 0.11209645645055544, 0.16609753295241333, 0.05709121033367666, 0.5489777997924157, 0.3460401482565978, 0.11277591498260317]
# [6.3472223819402345, 78.1371348194245, 116.67998632086044, 0.627495787624055, 0.17528072285119328, 0.037384974302898534, 7.702665672081748, 36.17903652071598, 0.42263294595020556, 0.04465036861862698, 4.722263907788516, 2.0387187480081255, 1.0919441812625301, 0.46860510593193266, 0.5900142592522831, 0.033707195281630825, 0.2990854921404516, 0.7386662405761952, 0.8457793834817413, 0.7189605932496281, 33.16013481779727, 0.42649495548771726, 0.11785081593421202, 0.0026908959049897095, 0.0003532660365399674, 0.08067990280598183, 0.1108533728662142, 10.60387485571885, 0.1122132564660273, 0.6186123087637284, 0.13925374842489605, 62.34429467571702, 0.42728230924320626, 0.06293247889634518, 3.137690223197778, 7.598805944322775, 0.8034916845383046, 1.2570017814256702, 1.4995065035422892, 0.0018227263055143647, 0.0158281706181689, 0.4451337830444737, 0.6727917984794645, 2.342922600131944, 0.31395151261665305, 0.6754261647257238, 0.6754261647257207, 2.381507298912948, 3.7121447660612534, 0.3341405723643274, 10.771432602806533, 1.1440048536245957, 0.1728615011354837, 1.0278681306989172, 0.5915858169234893, 1.557979537361309, 0.8207128900887555, 1.4849675647572786, 0.9540940213561823, 7.451446225489008, 3.200817802088914, 0.10623504858380807, 15.202101587633974, 0.26934403648454747, 0.34662109519477363, 0.7295448725267555, 8.787410543108031, 0.007142920647151013, 0.2543553764743683, 0.25435537647436607, 1.3966447888423097, 0.017247917199491005, 0.337584655376601, 0.682274471642917, 1.152349940953967, 0.22471065850039368, 0.40627410258600455, 0.0674846065784223, 0.10458263393216503, 2.8551952399339626, 0.7246118985412332, 14.172152872060293, 0.1354943169002691, 0.07925448855941475, 0.044744623084886775, 0.41215328352439046, 2.920319751237031, 1.4049722199085513, 0.16509727708978114]

# [10.525483970210251, 34.33346741631022, 117.27620716858279, 0.10924523031210194, 0.0015801688978628995, 0.0023241772634548198, 156.175352930616, 161.401948343245, 0.2391501838862601, 0.025459581907571263, 12.825858071806689, 15.103003447183074, 1.4431024128852517, 0.07782234381666306, 0.48227555930658494, 0.002025542516703709, 0.06100154828876084, 0.6609331819264258, 0.14290171512644767, 0.08951220390747175, 1.8030532557523034, 0.011734391467054376, 0.08743702788850999, 0.0006027368441319712, 0.0002268705595394421, 0.08536144585913036, 0.009229751200076616, 0.2391043842183079, 0.00473862666973115, 0.14271940434400074, 0.014330833979257182, 232.64831224558492, 0.09408585707198726, 0.020089032326318434, 1.4864323273619817, 225.071343332001, 0.47692692277817056, 1.153094707824754, 0.47792908475641405, 0.04121570291413727, 0.0039429725513677695, 0.3352252093686971, 5.57090664555936, 0.9602102212661793, 0.01846924387313226, 0.3846290538338341, 0.3846290538338116, 0.6730334618680416, 6.017110082617875, 0.15660149711960458, 0.6563684826647745, 5.173329225810333, 0.10388147112584062, 0.39759838128471586, 0.4176545610229287, 5.366595753916928, 0.837773448204873, 0.3956890182942336, 0.6540927441664314, 3.5431742139398184, 2.999921523160518, 0.18230658822486315, 24.36122954088186, 0.02951143543058638, 0.04781809168055518, 0.46323926480065075, 9.951028776095084, 0.003458428079532007, 0.3723777590542957, 0.37237775905428905, 5.602867073961827, 0.011223434127609186, 2.216679329408289, 0.40267006797265165, 3.0547974910372684, 0.07514296087221645, 0.01593682573640513, 0.03676862659575391, 0.051574128305388024, 0.806631534138451, 2.6218807632992864, 8.545293980931717, 0.0686896267216891, 0.08127279751002138, 0.026187185782600004, 0.3235478409716049, 0.5287257920333174, 0.28184433366889927, 0.05148429059249378]
# newp0 = [1.698211158400492, 3.855007065625004, 38.030795892861285, 0.17238760253236557, 0.001438704982315014, 0.0023280841283861648, 61.04734995057142, 301.26174730481534, 0.21576480746888954, 0.024336960105090115, 18.174524385075404, 16.28484726497296, 1.4670233880445465, 0.1118905240897136, 0.29925099896085877, 0.0018478811247117672, 0.05828560298445413, 0.47958904431306826, 0.14098530009391164, 0.1031855087845458, 0.8295813282009007, 0.01645686474637903, 0.08891126479398496, 0.0006265179533323064, 0.00023449572059598936, 0.04828523615467226, 0.007971829285648553, 0.5338717266829491, 0.004440308611850812, 0.5475482631742737, 0.030347477521284014, 228.8949907546949, 0.014058512984160545, 0.019089529047452602, 1.320512572455405, 167.29332098257922, 0.42887447458792727, 1.4272587633686449, 0.2688137200991113, 0.01967483112641747, 0.003984243799596882, 0.20616609006594164, 4.06162510645495, 1.0826375750124166, 0.016751783265003126, 0.341281096042798, 0.34128109604277823, 0.6268302866718283, 4.721417663917578, 0.142523575228236, 0.695026389278743, 3.608921073992914, 0.09545562787705751, 0.36333397527570976, 0.40569925397728634, 0.7754610031064468, 0.2161717683573189, 0.6351974620460856, 0.5634650078334402, 8.865714465238426, 4.903695928930026, 0.11581770956863806, 23.84296995586899, 0.015294014012186304, 0.0885902463995738, 0.4030568485503927, 11.58349327724782, 0.003189922045337134, 0.23615717440370687, 0.2361571744037042, 3.134625847151167, 0.01084613284762344, 2.7597348223031912, 0.35682997315714843, 2.6109227410332716, 0.05193574960447861, 0.013311828147145518, 0.020659441999569688, 0.04820623809304004, 0.8224043711712489, 3.1112863411342873, 6.958737905645931, 0.06376768502022864, 0.16419841466241178, 0.018737112164213796, 0.16824855895673888, 0.22939979131076346, 0.18830107249682188, 0.047062842611032545]